import{_ as e,o as a,c as l,Q as t}from"./chunks/framework.3d945e71.js";const u=JSON.parse('{"title":"骨架屏方案与实现","description":"","frontmatter":{},"headers":[],"relativePath":"frontend-engineering/前端性能优化/webpack优化/骨架屏方案与实现.md","filePath":"frontend-engineering/前端性能优化/webpack优化/骨架屏方案与实现.md","lastUpdated":1699346864000}'),i={name:"frontend-engineering/前端性能优化/webpack优化/骨架屏方案与实现.md"},o=t('<h1 id="骨架屏方案与实现" tabindex="-1">骨架屏方案与实现 <a class="header-anchor" href="#骨架屏方案与实现" aria-label="Permalink to &quot;骨架屏方案与实现&quot;">​</a></h1><p>本文参考实现：<a href="https://www.npmjs.com/package/page2-skeleton-webpack-plugin" target="_blank" rel="noreferrer">page2-skeleton-webpack-plugin</a></p><p><a href="https://github.com/fyhhub/page2-webpack-plugin-simple" target="_blank" rel="noreferrer">实现源码</a></p><h2 id="实现步骤" tabindex="-1">实现步骤 <a class="header-anchor" href="#实现步骤" aria-label="Permalink to &quot;实现步骤&quot;">​</a></h2><h3 id="一、准备阶段" tabindex="-1">一、准备阶段 <a class="header-anchor" href="#一、准备阶段" aria-label="Permalink to &quot;一、准备阶段&quot;">​</a></h3><ol><li>注册插件，监听 done 钩子</li><li>编译完成后启动一个本地服务，并且设置项目打包后的 dist 文件夹，为服务的静态资源文件夹</li><li>创建 Skeleton 实例</li><li><code>skeleton.init()</code>初始化，使用<code>puppeteer</code>启动一个无头浏览器</li></ol><h3 id="二、生成骨架代码" tabindex="-1">二、生成骨架代码 <a class="header-anchor" href="#二、生成骨架代码" aria-label="Permalink to &quot;二、生成骨架代码&quot;">​</a></h3><ol><li>使用无头浏览器，打开一个页面，并以某种机型启动，例如 iphone 6</li><li>调用 addScriptTag，为页面注入 JS 脚本，并执行脚本，脚本所做的事： <ul><li>从 html 开始递归遍历所有 dom 节点，并收集 button 节点，img 节点等</li><li>单独为每个收集到的节点，添加 class，例如<code>.sk-img</code>, 并生成 style 样式（包含骨架屏样式，例如灰色背景或者动画等）</li><li>append style 节点到 head 节点最后</li><li>删除掉, 除了<code>.sk-</code>以外的所有 style 标签，meta 标签，script 标签等</li><li>返回以上的 html 片段和 styles</li></ul></li></ol><h3 id="三、写入文件" tabindex="-1">三、写入文件 <a class="header-anchor" href="#三、写入文件" aria-label="Permalink to &quot;三、写入文件&quot;">​</a></h3><ol><li>将上面生成的<code>styles</code>和<code>html</code>片段，替换掉我们项目生成<code>index.html</code>里的占位注释<code>&lt;!-- shell --&gt;</code></li><li>重新写入文件</li></ol>',10),r=[o];function n(c,d,s,h,p,_){return a(),l("div",null,r)}const k=e(i,[["render",n]]);export{u as __pageData,k as default};
