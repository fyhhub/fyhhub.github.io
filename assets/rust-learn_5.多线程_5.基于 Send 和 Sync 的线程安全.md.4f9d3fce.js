import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.3d945e71.js";const S=JSON.parse('{"title":"基于 Send 和 Sync 的线程安全","description":"","frontmatter":{},"headers":[],"relativePath":"rust-learn/5.多线程/5.基于 Send 和 Sync 的线程安全.md","filePath":"rust-learn/5.多线程/5.基于 Send 和 Sync 的线程安全.md","lastUpdated":1713452287000}'),o={name:"rust-learn/5.多线程/5.基于 Send 和 Sync 的线程安全.md"},p=l(`<h1 id="基于-send-和-sync-的线程安全" tabindex="-1">基于 Send 和 Sync 的线程安全 <a class="header-anchor" href="#基于-send-和-sync-的线程安全" aria-label="Permalink to &quot;基于 Send 和 Sync 的线程安全&quot;">​</a></h1><h2 id="一、rc-和-arc-源码对比" tabindex="-1">一、Rc 和 Arc 源码对比 <a class="header-anchor" href="#一、rc-和-arc-源码对比" aria-label="Permalink to &quot;一、Rc 和 Arc 源码对比&quot;">​</a></h2><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// Rc源码片段</span></span>
<span class="line"><span style="color:#F97583;">impl</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">T</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">?</span><span style="color:#B392F0;">Sized</span><span style="color:#E1E4E8;">&gt; </span><span style="color:#F97583;">!</span><span style="color:#B392F0;">marker</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">Send</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Rc</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">T</span><span style="color:#E1E4E8;">&gt; {}</span><span style="color:#6A737D;"> // 此处Send被移除了</span></span>
<span class="line"><span style="color:#F97583;">impl</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">T</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">?</span><span style="color:#B392F0;">Sized</span><span style="color:#E1E4E8;">&gt; </span><span style="color:#F97583;">!</span><span style="color:#B392F0;">marker</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">Sync</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Rc</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">T</span><span style="color:#E1E4E8;">&gt; {}</span><span style="color:#6A737D;"> // 此处Sync被移除了</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Arc源码片段</span></span>
<span class="line"><span style="color:#F97583;">unsafe</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">impl</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">T</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">?</span><span style="color:#B392F0;">Sized</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Sync</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Send</span><span style="color:#E1E4E8;">&gt; </span><span style="color:#B392F0;">Send</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Arc</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">T</span><span style="color:#E1E4E8;">&gt; {}</span></span>
<span class="line"><span style="color:#F97583;">unsafe</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">impl</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">T</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">?</span><span style="color:#B392F0;">Sized</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Sync</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Send</span><span style="color:#E1E4E8;">&gt; </span><span style="color:#B392F0;">Sync</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Arc</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">T</span><span style="color:#E1E4E8;">&gt; {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// Rc源码片段</span></span>
<span class="line"><span style="color:#D73A49;">impl</span><span style="color:#24292E;">&lt;</span><span style="color:#6F42C1;">T</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">?</span><span style="color:#6F42C1;">Sized</span><span style="color:#24292E;">&gt; </span><span style="color:#D73A49;">!</span><span style="color:#6F42C1;">marker</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">Send</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Rc</span><span style="color:#24292E;">&lt;</span><span style="color:#6F42C1;">T</span><span style="color:#24292E;">&gt; {}</span><span style="color:#6A737D;"> // 此处Send被移除了</span></span>
<span class="line"><span style="color:#D73A49;">impl</span><span style="color:#24292E;">&lt;</span><span style="color:#6F42C1;">T</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">?</span><span style="color:#6F42C1;">Sized</span><span style="color:#24292E;">&gt; </span><span style="color:#D73A49;">!</span><span style="color:#6F42C1;">marker</span><span style="color:#D73A49;">::</span><span style="color:#6F42C1;">Sync</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Rc</span><span style="color:#24292E;">&lt;</span><span style="color:#6F42C1;">T</span><span style="color:#24292E;">&gt; {}</span><span style="color:#6A737D;"> // 此处Sync被移除了</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Arc源码片段</span></span>
<span class="line"><span style="color:#D73A49;">unsafe</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">impl</span><span style="color:#24292E;">&lt;</span><span style="color:#6F42C1;">T</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">?</span><span style="color:#6F42C1;">Sized</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Sync</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Send</span><span style="color:#24292E;">&gt; </span><span style="color:#6F42C1;">Send</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Arc</span><span style="color:#24292E;">&lt;</span><span style="color:#6F42C1;">T</span><span style="color:#24292E;">&gt; {}</span></span>
<span class="line"><span style="color:#D73A49;">unsafe</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">impl</span><span style="color:#24292E;">&lt;</span><span style="color:#6F42C1;">T</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">?</span><span style="color:#6F42C1;">Sized</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Sync</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Send</span><span style="color:#24292E;">&gt; </span><span style="color:#6F42C1;">Sync</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Arc</span><span style="color:#24292E;">&lt;</span><span style="color:#6F42C1;">T</span><span style="color:#24292E;">&gt; {}</span></span></code></pre></div><p><strong>!代表移除特征的相应实现，上面代码中<code>Rc&lt;T&gt;</code>的Send和Sync特征被特地移除了实现，而<code>Arc&lt;T&gt;</code>则相反，实现了<code>Sync + Send</code>，再结合之前的编译器报错，大概可以明白了：Send和Sync是在线程间安全使用一个值的关键。</strong></p><h2 id="二、send-和-sync" tabindex="-1">二、Send 和 Sync <a class="header-anchor" href="#二、send-和-sync" aria-label="Permalink to &quot;二、Send 和 Sync&quot;">​</a></h2><p><code>Send</code>和<code>Sync</code>是 Rust 安全并发的重中之重，但是实际上它们只是标记特征(marker trait，该特征未定义任何行为，因此非常适合用于标记), 来看看它们的作用：</p><ul><li>实现<code>Send</code>的类型可以在线程间安全的传递其所有权</li><li>实现<code>Sync</code>的类型可以在线程间安全的共享(通过引用)</li></ul>`,7),e=[p];function c(t,r,y,E,d,F){return n(),a("div",null,e)}const A=s(o,[["render",c]]);export{S as __pageData,A as default};
